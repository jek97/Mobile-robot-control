<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>scripts.node_c &mdash; Mobile robot control 0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Mobile robot control
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Mobile robot control</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">scripts.node_c</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for scripts.node_c</h1><div class="highlight"><pre>
<span></span><span class="ch">#! /usr/bin/env python3</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. module:: node_c</span>
<span class="sd">   :platform: Unix</span>
<span class="sd">   :synopsis: Python module for printing on the terminal the robot informations</span>

<span class="sd">.. moduleauthor:: Giacomo Lugano jek.lugano@yahoo.com</span>

<span class="sd">This node will use the information received to print on the terminal the actual distance to the goal and the average speed of tyhe robot.</span>

<span class="sd">Parameter:</span>
<span class="sd">   des_pos_x (input)</span>
<span class="sd">   des_pos_y (input)</span>
<span class="sd">   </span>
<span class="sd">Subscriber:</span>
<span class="sd">   /configuration</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="kn">import</span> <span class="nn">assignment_2_2022.msg</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">goal</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
<span class="n">d</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># init the distance</span>
<span class="n">v</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># init the actual velocity</span>
<span class="n">old_v</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># init the previous actual velocity</span>
<span class="n">av</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># init the average velocity</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># init the counter</span>

<div class="viewcode-block" id="confy_cb"><a class="viewcode-back" href="../../index.html#scripts.node_c.confy_cb">[docs]</a><span class="k">def</span> <span class="nf">confy_cb</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args: assignment_2_2022.msg.Conf(msg): actual position and velocity of the robot</span>

<span class="sd">    In this method first the goal is retrieved form the ros parameter server, the distance between the robot position and the goal is evaluated together with the average speed, all controlled by the counter &#39;n&#39; used for the average operation, if it&#39;s a multiple of 40 then the two information are displaied.</span>
<span class="sd">    </span>
<span class="sd">    Return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">av</span>
    <span class="c1"># increase the counter:</span>
    <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># obtain the goal position:</span>
    <span class="n">goal</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s1">&#39;des_pos_x&#39;</span><span class="p">)</span> <span class="c1"># get the actual x goal</span>
    <span class="n">goal</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s1">&#39;des_pos_y&#39;</span><span class="p">)</span> <span class="c1"># get the actual x goal</span>
    <span class="c1"># compute the distance:</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">goal</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">msg</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">pow</span><span class="p">(</span><span class="n">goal</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">msg</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="c1"># compute the average speed:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">Vx</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">pow</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">Vy</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="c1"># compute the actual speed module</span>
    <span class="n">av</span> <span class="o">=</span> <span class="p">(</span><span class="n">old_v</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span> <span class="c1"># compute the average speed in time</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">n</span> <span class="o">%</span> <span class="mi">40</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c1"># print on the terminal:</span>
        <span class="n">log</span> <span class="o">=</span> <span class="s2">&quot;distance from the goal: </span><span class="si">%f</span><span class="s2">; average speed: </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">av</span><span class="p">)</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">log</span><span class="p">)</span></div>

<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../index.html#scripts.node_c.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args: None</span>

<span class="sd">    This method initialize the node, subscribe to the topic */configuration* to aquire the information about the robot position and velocity and wait for the master to be launched, after that the node will spin.</span>
<span class="sd">    </span>
<span class="sd">    Return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;node_c&#39;</span><span class="p">,</span> <span class="n">anonymous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># init the node</span>
    <span class="n">sub_confy</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s1">&#39;/configuration&#39;</span><span class="p">,</span> <span class="n">assignment_2_2022</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">Conf</span><span class="p">,</span> <span class="n">confy_cb</span><span class="p">)</span> <span class="c1"># sub to odom to obtain position and velocity</span>

    <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span>
        <span class="n">rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>

    <span class="n">rospy</span><span class="o">.</span><span class="n">spin</span><span class="p">()</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Lugano Giacomo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>